<ion-header class="header-improved" [class.header-compact]="isHeaderCompact">
  <!-- Subtle background gradient -->
  <div class="header-bg-gradient"></div>

  <div class="header-wrapper">
    <!-- ‚îÄ‚îÄ‚îÄ STICKY TOP BAR ‚îÄ‚îÄ‚îÄ -->
    <div class="top-bar">
      <div class="brand-section">
        <h1 class="brand-logo" [class.compact]="isHeaderCompact">
          Central<span class="brand-accent">Market</span>
        </h1>
      </div>

      <div class="top-actions">
        <button class="icon-btn search-trigger" (click)="focusSearch()">
          <ion-icon name="search-outline"></ion-icon>
        </button>
        <button class="icon-btn cart-btn" (click)="goToCart()">
          <ion-icon name="bag-outline"></ion-icon>
          <span *ngIf="cartCount > 0" class="badge badge-primary">
            {{ cartCount > 99 ? '99+' : cartCount }}
          </span>
        </button>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ HERO SECTION (Collapsible) ‚îÄ‚îÄ‚îÄ -->
    <div class="hero-section" [class.collapsed]="isHeaderCompact">
      <div class="hero-wrapper">
        <div class="hero-content">
          <div class="hero-badge">
            <span class="badge-icon">‚ö°</span>
            <span class="badge-text">Ventes Flash</span>
          </div>
          <h2 class="hero-title">
            D√©couvrez nos<br>
            <span class="gradient-text">P√©pites du jour</span>
          </h2>
          <p class="hero-subtitle">Premium qualit√©, livraison rapide</p>
        </div>
        <div class="hero-visual">
          <div class="visual-orb orb-1"></div>
          <div class="visual-orb orb-2"></div>
          <ion-icon name="bag-handle" class="hero-icon"></ion-icon>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ SEARCH BAR ‚îÄ‚îÄ‚îÄ -->
    <div class="search-section">
      <div class="search-container">
        <ion-icon name="search-outline" class="search-icon"></ion-icon>
        <input
          type="search"
          class="search-field"
          placeholder="Rechercher une p√©pite..."
          [value]="queryParams.keyword"
          (input)="onSearch($event)"
          #searchInput
        />
        <button 
          *ngIf="queryParams.keyword" 
          class="clear-btn"
          (click)="clearSearch()"
          type="button"
        >
          <ion-icon name="close-circle"></ion-icon>
        </button>
      </div>
      <button class="filter-btn" [class.active]="hasActiveFilters" (click)="openFilters()" type="button">
        <ion-icon name="options-outline"></ion-icon>
      </button>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ CATEGORIES SCROLL ‚îÄ‚îÄ‚îÄ -->
    <div class="categories-section" [class.collapsed]="isHeaderCompact">
      <div class="categories-scroll no-scrollbar">
        <div
          *ngFor="let cat of categories; let i = index"
          class="category-chip"
          [class.active]="activeCategory === cat.id"
          (click)="selectCategory(cat.id)"
          role="button"
          tabindex="0"
        >
          <div class="chip-icon">
            <ion-icon [name]="cat.icon"></ion-icon>
          </div>
          <span class="chip-label">{{ cat.label }}</span>
        </div>
      </div>
    </div>
  </div>
</ion-header>

<!-- ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ -->
<ion-content [scrollEvents]="true" (ionScroll)="onScroll($event)" class="content-improved" scrollX="false" scrollY="true">

  <!-- Section Header -->
  <div class="content-header" *ngIf="!isLoading">
    <div class="header-info">
      <h3 class="section-title">Catalogue</h3>
      <p class="section-meta">{{ products.length }} articles disponibles</p>
    </div>
  </div>

  <!-- Loading Skeleton -->
  <div *ngIf="isLoading" class="products-container">
    <div class="product-grid">
      <div *ngFor="let i of [1,2,3,4,5,6]" class="skeleton-loader">
        <div class="skeleton-image"></div>
        <div class="skeleton-content">
          <div class="skeleton-line line-title"></div>
          <div class="skeleton-line line-price"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Grid -->
  <div *ngIf="!isLoading && products.length > 0" class="products-container">
    <div class="product-grid">
      <app-product-card
        *ngFor="let product of products; trackBy: trackById"
        [product]="product"
        class="product-item"
      ></app-product-card>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && products.length === 0" class="empty-state-container">
    <div class="empty-state">
      <div class="empty-icon">üîç</div>
      <h3 class="empty-title">Aucun r√©sultat</h3>
      <p class="empty-description">Essayez d'autres mots-cl√©s ou modifiez vos filtres</p>
      <button class="btn-reset" (click)="resetFilters()" type="button">
        <ion-icon name="refresh-outline"></ion-icon>
        R√©initialiser
      </button>
    </div>
  </div>

  <!-- Padding for bottom navigation -->
  <div class="content-bottom-spacing"></div>

</ion-content>

<!-- ‚îÄ‚îÄ‚îÄ FILTER MODAL (Bottom Sheet) ‚îÄ‚îÄ‚îÄ -->
<ion-modal
  [isOpen]="isFilterModalOpen"
  (didDismiss)="closeFilters()"
  [initialBreakpoint]="0.75"
  [breakpoints]="[0, 0.75, 1]"
  [handle]="true"
  [handleBehavior]="'cycle'"
  class="filter-modal"
>
  <ng-template>
    <div class="modal-container">
      <div class="modal-header">
        <h2 class="modal-title">Filtrer les r√©sultats</h2>
        <button class="btn-close" (click)="closeFilters()" type="button">
          <ion-icon name="close"></ion-icon>
        </button>
      </div>

      <ion-content [scrollY]="true" class="modal-content">
        <div class="filter-group">
          <!-- Promotions Filter -->
          <div class="filter-item promo-filter">
            <div class="filter-header">
              <div class="filter-icon">
                <ion-icon name="pricetag-outline"></ion-icon>
              </div>
              <div class="filter-info">
                <p class="filter-title">Promotions</p>
                <p class="filter-description">Afficher uniquement les offres</p>
              </div>
            </div>
            <ion-toggle
              [(ngModel)]="queryParams.promotionOnly"
              mode="ios"
              class="toggle-switch"
            ></ion-toggle>
          </div>

          <!-- Price Range Filter -->
          <div class="filter-item price-filter">
            <div class="filter-header">
              <div class="filter-icon">
                <ion-icon name="wallet-outline"></ion-icon>
              </div>
              <div class="filter-info">
                <p class="filter-title">Budget Maximum</p>
                <p class="price-value">
                  {{ queryParams.maxPrice | number:'1.0-0' }}
                  <span class="price-unit">FCFA</span>
                </p>
              </div>
            </div>
            <ion-range
              [min]="0"
              [max]="10000"
              [step]="500"
              [(ngModel)]="queryParams.maxPrice"
              class="price-range"
              [pin]="false"
            ></ion-range>
          </div>
        </div>
      </ion-content>

      <div class="modal-footer">
        <button class="btn-secondary" (click)="resetFilters()" type="button">
          R√©initialiser
        </button>
        <button class="btn-primary" (click)="applyFilters()" type="button">
          Appliquer les filtres
        </button>
      </div>
    </div>
  </ng-template>
</ion-modal>
